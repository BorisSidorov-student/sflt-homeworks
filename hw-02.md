# Домашнее задание к занятию "`Кластеризация и балансировка нагрузки`" - `Сидоров Борис`

---
---

### Задание 1
- Запустите два simple python сервера на своей виртуальной машине на разных портах
- Установите и настройте HAProxy, воспользуйтесь материалами к лекции по [ссылке](2/)
- Настройте балансировку Round-robin на 4 уровне.
- На проверку направьте конфигурационный файл haproxy, скриншоты, где видно перенаправление запросов на разные серверы при обращении к HAProxy.

---

### Решение 1
Подготовил тестовую среду для проведения работ по балансировки нагрузки, а именно:
- запустил два simple python сервера в ранее созданных директориях с файлам **`index.html`**, содержимое которых **`Server 1 Port 8888`** и **`9999`** для второго соответственно. Запускал сервера используя команду из лекции **`python3 -m http.server 8888 --bind 0.0.0.0`**
- установил сервис **HAProxy** с конфигурационным файлом
![L7_haproxy.cfg](screen/hm-02/task-1/hw-02-1.1.png)

поля с правилом **`ACL_example`** пока закомментировал,  так как по заданию пока не требуются.
проверяю работу сервиса на уровне **L7**, как было настроено изначально на примере.
![curl](screen/hm-02/task-1/hw-02-1.2.png)

да метод **`roundrobin`** работает.

Теперь, редактирую конфиуграционный файл под требование задания. Меняю режим **`mode`** с **`http`** на **`tcp`** в секции **`frontend`** и **`backend`**, а также в секции **`default`** в строке **`mode`** выставляю **`tcp`**, а в строке **`option`** меняю на **`tcplog`**. Ещё изменил опцию проверки серверов с  **`httpchk`** на **`tcp-check`**, а строку **`http-check send meth GET uri /index.html`** просто удалил. По итогу конфигурационный файл стал таким:
[L4_haproxy.cfg](files/hw-02/task-1/haproxy.cfg)

Перезапускаю сервис **`haproxy`** через **`reload`** и пробую ещё раз обратиться к **`haproxy`** через **`curl`**
![curl](screen/hm-02/task-1/hw-02-1.3.png)
